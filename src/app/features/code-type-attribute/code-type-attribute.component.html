<div class="code-type-attribute-container">
    <div class="header">
        <h2>Code Type Attribute</h2>
        <p class="description">Define attributes dynamically - {{ attributes.length }} attribute(s) added</p>
    </div>

    <div class="content">
        <div class="card">
            <h3>Add New Attribute</h3>
            <p>Enter attribute details and click "Add Attribute" to add it to the list</p>

            <app-alert *ngIf="successMessage" type="success" [message]="successMessage"></app-alert>
            <app-alert *ngIf="errorMessage" type="error" [message]="errorMessage"></app-alert>

            <form [formGroup]="attributeForm" (ngSubmit)="onSubmit()" class="form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="nameAr">Name (Arabic) <span class="required">*</span></label>
                        <input id="nameAr" type="text" formControlName="nameAr" placeholder="الاسم بالعربية" dir="rtl"
                            [class.invalid]="nameAr?.invalid && nameAr?.touched" />
                        @if (nameAr?.invalid && nameAr?.touched) {
                        <span class="error-text">Arabic name is required</span>
                        }
                    </div>

                    <div class="form-group">
                        <label for="nameEn">Name (English) <span class="required">*</span></label>
                        <input id="nameEn" type="text" formControlName="nameEn" placeholder="English Name"
                            [class.invalid]="nameEn?.invalid && nameEn?.touched" />
                        @if (nameEn?.invalid && nameEn?.touched) {
                        <span class="error-text">English name is required</span>
                        }
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="descriptionAr">Description (Arabic) <span class="required">*</span></label>
                        <textarea id="descriptionAr" formControlName="descriptionAr" placeholder="الوصف بالعربية"
                            dir="rtl" rows="4"
                            [class.invalid]="descriptionAr?.invalid && descriptionAr?.touched"></textarea>
                        @if (descriptionAr?.invalid && descriptionAr?.touched) {
                        <span class="error-text">Arabic description is required</span>
                        }
                    </div>

                    <div class="form-group">
                        <label for="descriptionEn">Description (English) <span class="required">*</span></label>
                        <textarea id="descriptionEn" formControlName="descriptionEn" placeholder="English Description"
                            rows="4" [class.invalid]="descriptionEn?.invalid && descriptionEn?.touched"></textarea>
                        @if (descriptionEn?.invalid && descriptionEn?.touched) {
                        <span class="error-text">English description is required</span>
                        }
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary" [disabled]="isLoading">
                        Add Attribute
                    </button>
                </div>
            </form>
        </div>

        @if (attributes.length > 0) {
        <div class="card attributes-list">
            <h3>Added Attributes ({{ attributes.length }})</h3>
            <p>Review your attributes before saving</p>
            
            <div class="attributes-table">
                @for (attribute of attributes; track $index) {
                <div class="attribute-item">
                    <div class="attribute-header">
                        <h4>Attribute #{{ $index + 1 }}</h4>
                        <button type="button" class="btn btn-delete" (click)="removeAttribute($index)" [disabled]="isLoading">
                            ✕ Remove
                        </button>
                    </div>
                    <div class="attribute-details">
                        <div class="detail-row">
                            <div class="detail-item">
                                <strong>Name (Arabic):</strong>
                                <span dir="rtl">{{ attribute.nameAr }}</span>
                            </div>
                            <div class="detail-item">
                                <strong>Name (English):</strong>
                                <span>{{ attribute.nameEn }}</span>
                            </div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-item">
                                <strong>Description (Arabic):</strong>
                                <span dir="rtl">{{ attribute.descriptionAr }}</span>
                            </div>
                            <div class="detail-item">
                                <strong>Description (English):</strong>
                                <span>{{ attribute.descriptionEn }}</span>
                            </div>
                        </div>
                    </div>
                </div>
                }
            </div>

            <div class="save-all-actions">
                <button type="button" class="btn btn-success" (click)="saveAllAttributes()" [disabled]="isLoading">
                    @if (isLoading) {
                    <span class="spinner"></span>
                    Saving All Attributes...
                    } @else {
                    Save All Attributes & Continue
                    }
                </button>
            </div>
        </div>
        }
    </div>
</div>