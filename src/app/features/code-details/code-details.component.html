<div class="code-details-container">
    <div class="header">
        <h2>Code Details</h2>
        <p class="description">Define details - {{ details.length }} of {{ attributeMainIds.length }} entries added</p>
    </div>

    <div class="content">
        <div class="card">
            <h3>Add New Detail Entry</h3>

            <app-alert *ngIf="successMessage" type="success" [message]="successMessage"></app-alert>
            <app-alert *ngIf="errorMessage" type="error" [message]="errorMessage"></app-alert>

            <form [formGroup]="detailForm" (ngSubmit)="onSubmit()" class="form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="code">Code <span class="required">*</span></label>
                        <input id="code" type="text" formControlName="code" placeholder="e.g., XYZ, ABC"
                            [class.invalid]="code?.invalid && code?.touched" />
                        @if (code?.invalid && code?.touched) {
                        <span class="error-text">Code is required (min 2 chars)</span>
                        }
                    </div>

                    <div class="form-group">
                        <label for="sortOrder">Sort Order <span class="required">*</span></label>
                        <input id="sortOrder" type="number" formControlName="sortOrder" readonly
                            class="readonly-input" />
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="nameAr">Name (Arabic) <span class="required">*</span></label>
                        <input id="nameAr" type="text" formControlName="nameAr" placeholder="الاسم بالعربية" dir="rtl"
                            [class.invalid]="nameAr?.invalid && nameAr?.touched" />
                        @if (nameAr?.invalid && nameAr?.touched) {
                        <span class="error-text">Arabic name is required</span>
                        }
                    </div>

                    <div class="form-group">
                        <label for="nameEn">Name (English) <span class="required">*</span></label>
                        <input id="nameEn" type="text" formControlName="nameEn" placeholder="English Name"
                            [class.invalid]="nameEn?.invalid && nameEn?.touched" />
                        @if (nameEn?.invalid && nameEn?.touched) {
                        <span class="error-text">English name is required</span>
                        }
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="descriptionAr">Description (Arabic) <span class="required">*</span></label>
                        <textarea id="descriptionAr" formControlName="descriptionAr" placeholder="الوصف بالعربية"
                            dir="rtl" rows="4"
                            [class.invalid]="descriptionAr?.invalid && descriptionAr?.touched"></textarea>
                        @if (descriptionAr?.invalid && descriptionAr?.touched) {
                        <span class="error-text">Arabic description is required</span>
                        }
                    </div>

                    <div class="form-group">
                        <label for="descriptionEn">Description (English) <span class="required">*</span></label>
                        <textarea id="descriptionEn" formControlName="descriptionEn" placeholder="English Description"
                            rows="4" [class.invalid]="descriptionEn?.invalid && descriptionEn?.touched"></textarea>
                        @if (descriptionEn?.invalid && descriptionEn?.touched) {
                        <span class="error-text">English description is required</span>
                        }
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary" [disabled]="isLoading || details.length >= attributeMainIds.length">
                        Add Detail
                    </button>
                </div>
            </form>
        </div>

        @if (details.length > 0) {
        <div class="card details-list">
            <h3>Added Detail Entries ({{ details.length }}/{{ attributeMainIds.length }})</h3>
            <p>Review your detail entries before saving</p>
            
            <div class="details-table">
                @for (detail of details; track $index) {
                <div class="detail-item">
                    <div class="detail-header">
                        <h4>Detail Entry #{{ $index + 1 }}</h4>
                        <button type="button" class="btn btn-delete" (click)="removeDetail($index)" [disabled]="isLoading">
                            ✕ Remove
                        </button>
                    </div>
                    <div class="detail-details">
                        <div class="detail-row">
                            <div class="detail-field">
                                <strong>Code:</strong>
                                <span>{{ detail.code }}</span>
                            </div>
                            <div class="detail-field">
                                <strong>Sort Order:</strong>
                                <span>{{ detail.sortOrder }}</span>
                            </div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-field">
                                <strong>Name (Arabic):</strong>
                                <span dir="rtl">{{ detail.nameAr }}</span>
                            </div>
                            <div class="detail-field">
                                <strong>Name (English):</strong>
                                <span>{{ detail.nameEn }}</span>
                            </div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-field">
                                <strong>Description (Arabic):</strong>
                                <span dir="rtl">{{ detail.descriptionAr }}</span>
                            </div>
                            <div class="detail-field">
                                <strong>Description (English):</strong>
                                <span>{{ detail.descriptionEn }}</span>
                            </div>
                        </div>
                    </div>
                </div>
                }
            </div>

            <div class="save-all-actions">
                <button type="button" class="btn btn-success" (click)="saveAllDetails()" [disabled]="isLoading || details.length !== attributeMainIds.length">
                    @if (isLoading) {
                    <span class="spinner"></span>
                    Saving All Details...
                    } @else {
                    Save All Details & Continue
                    }
                </button>
            </div>
        </div>
        }
    </div>
</div>