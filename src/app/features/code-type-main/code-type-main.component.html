<div class="code-type-main-container">
    <div class="page-header">
        <h1>Code Details</h1>
        <p class="page-description">Configure main entries and details in one streamlined page</p>
    </div>

    <!-- SECTION 1: CODE TYPE MAIN -->
    <section class="section main-section">
        <div class="section-header">
            <div class="section-title">
                <span class="section-number">1</span>
                <h2>Code Type Main</h2>
            </div>
            <p class="section-description">Configure main settings - {{ mains.length }} entries added</p>
        </div>

        <div class="content">
            <div class="card">
                <h3>Add New Main Entry</h3>
                <p>Enter main details and click "Add Main" to add it to the list</p>

                @if (successMessage) {
                <div class="alert alert-success">{{ successMessage }}</div>
                }

                @if (errorMessage) {
                <div class="alert alert-error">{{ errorMessage }}</div>
                }

                <form [formGroup]="mainForm" (ngSubmit)="onSubmitMain()" class="form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="mainCodeTypeId">Code Type <span class="required">*</span></label>
                            <select id="mainCodeTypeId" formControlName="codeTypeId"
                                [class.invalid]="mainCodeTypeId?.invalid && mainCodeTypeId?.touched">
                                <option value="">Select Code Type</option>
                                @for (codeType of codeTypes; track codeType.id) {
                                <option [value]="codeType.id">{{ codeType.codeTypeCode }}
                                </option>
                                }
                            </select>
                            @if (mainCodeTypeId?.invalid && mainCodeTypeId?.touched) {
                            <span class="error-text">Code Type is required</span>
                            }
                        </div>

                        <div class="form-group">
                            <label for="mainCodeAttributeTypeId">Code Attribute Type <span
                                    class="required">*</span></label>
                            <select id="mainCodeAttributeTypeId" formControlName="codeAttributeTypeId"
                                [class.invalid]="mainCodeAttributeTypeId?.invalid && mainCodeAttributeTypeId?.touched">
                                <option value="">Select Code Attribute Type</option>
                                @for (attributeType of codeAttributeTypes; track attributeType.id) {
                                <option [value]="attributeType.id">{{ attributeType.nameEn }}</option>
                                }
                            </select>
                            @if (mainCodeAttributeTypeId?.invalid && mainCodeAttributeTypeId?.touched) {
                            <span class="error-text">Code Attribute Type is required</span>
                            }
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="mainCode">Code <span class="required">*</span></label>
                            <input id="mainCode" type="text" formControlName="code" placeholder="e.g., SYS, DEPT"
                                [class.invalid]="mainCode?.invalid && mainCode?.touched" />
                            @if (mainCode?.invalid && mainCode?.touched) {
                            <span class="error-text">
                                @if (mainCode?.errors?.['required']) {
                                Code is required
                                } @else if (mainCode?.errors?.['minlength']) {
                                Code must be at least 2 characters
                                }
                            </span>
                            }
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="mainNameAr">Name (Arabic) <span class="required">*</span></label>
                            <input id="mainNameAr" type="text" formControlName="nameAr" placeholder="Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"
                                dir="rtl" [class.invalid]="mainNameAr?.invalid && mainNameAr?.touched" />
                            @if (mainNameAr?.invalid && mainNameAr?.touched) {
                            <span class="error-text">Arabic name is required</span>
                            }
                        </div>

                        <div class="form-group">
                            <label for="mainNameEn">Name (English) <span class="required">*</span></label>
                            <input id="mainNameEn" type="text" formControlName="nameEn" placeholder="English Name"
                                [class.invalid]="mainNameEn?.invalid && mainNameEn?.touched" />
                            @if (mainNameEn?.invalid && mainNameEn?.touched) {
                            <span class="error-text">English name is required</span>
                            }
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="mainDescriptionAr">Description (Arabic) <span class="required">*</span></label>
                            <textarea id="mainDescriptionAr" formControlName="descriptionAr"
                                placeholder="Ø§Ù„ÙˆØµÙ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©" dir="rtl" rows="4"
                                [class.invalid]="mainDescriptionAr?.invalid && mainDescriptionAr?.touched"></textarea>
                            @if (mainDescriptionAr?.invalid && mainDescriptionAr?.touched) {
                            <span class="error-text">Arabic description is required</span>
                            }
                        </div>

                        <div class="form-group">
                            <label for="mainDescriptionEn">Description (English) <span class="required">*</span></label>
                            <textarea id="mainDescriptionEn" formControlName="descriptionEn"
                                placeholder="English Description" rows="4"
                                [class.invalid]="mainDescriptionEn?.invalid && mainDescriptionEn?.touched"></textarea>
                            @if (mainDescriptionEn?.invalid && mainDescriptionEn?.touched) {
                            <span class="error-text">English description is required</span>
                            }
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary" [disabled]="isLoading || mainsSaved">
                            Add Main
                        </button>
                    </div>
                </form>
            </div>

            @if (mains.length > 0) {
            <div class="card mains-list">
                <h3>Added Main Entries ({{ mains.length }})</h3>
                <p>Review your main entries before saving</p>

                <div class="mains-table">
                    @for (main of mains; track $index) {
                    <div class="main-item">
                        <div class="main-header">
                            <h4>Main Entry #{{ $index + 1 }}</h4>
                            <button type="button" class="btn btn-delete" (click)="removeMain($index)"
                                [disabled]="isLoading || mainsSaved">
                                âœ• Remove
                            </button>
                        </div>
                        <div class="main-details">
                            <div class="detail-row">
                                <div class="detail-item">
                                    <strong>Code Type ID:</strong>
                                    <span>{{ main.codeTypeId }}</span>
                                </div>
                                <div class="detail-item">
                                    <strong>Code Attribute Type ID:</strong>
                                    <span>{{ main.codeAttributeTypeId }}</span>
                                </div>
                            </div>
                            <div class="detail-row">
                                <div class="detail-item">
                                    <strong>Code:</strong>
                                    <span>{{ main.code }}</span>
                                </div>
                            </div>
                            <div class="detail-row">
                                <div class="detail-item">
                                    <strong>Name (Arabic):</strong>
                                    <span dir="rtl">{{ main.nameAr }}</span>
                                </div>
                                <div class="detail-item">
                                    <strong>Name (English):</strong>
                                    <span>{{ main.nameEn }}</span>
                                </div>
                            </div>
                            <div class="detail-row">
                                <div class="detail-item">
                                    <strong>Description (Arabic):</strong>
                                    <span dir="rtl">{{ main.descriptionAr }}</span>
                                </div>
                                <div class="detail-item">
                                    <strong>Description (English):</strong>
                                    <span>{{ main.descriptionEn }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    }
                </div>

                <div class="save-all-actions">
                    <button type="button" class="btn btn-success" (click)="saveAllMains()"
                        [disabled]="isLoading || mainsSaved">
                        @if (isLoading) {
                        <span class="spinner"></span>
                        Saving All Mains...
                        } @else if (mainsSaved) {
                        âœ“ All Mains Saved
                        } @else {
                        Save All Mains & Continue to Details
                        }
                    </button>
                </div>
            </div>
            }
        </div>
    </section>

    <!-- SECTION 2: CODE DETAILS -->
    <section class="section details-section" id="details-section">
        <div class="section-header">
            <div class="section-title">
                <span class="section-number">2</span>
                <h2>Code Details</h2>
            </div>
            <p class="section-description">Define details - {{ details.length }} entries added</p>
            @if (!mainsSaved) {
            <div class="section-locked">
                <span class="lock-icon">ðŸ”’</span>
                <p>Complete and save all Main entries above to unlock this section</p>
            </div>
            }
        </div>

        <div class="content" [class.disabled]="!mainsSaved">
            <div class="card">
                <h3>Add New Detail Entry</h3>
                <p>Enter detail information - {{ details.length }} details added</p>

                @if (successMessage && mainsSaved) {
                <div class="alert alert-success">{{ successMessage }}</div>
                }

                @if (errorMessage && mainsSaved) {
                <div class="alert alert-error">{{ errorMessage }}</div>
                }

                <form [formGroup]="detailForm" (ngSubmit)="onSubmitDetail()" class="form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="detailCode">Code <span class="required">*</span></label>
                            <input id="detailCode" type="text" formControlName="code" placeholder="e.g., XYZ, ABC"
                                [class.invalid]="detailCode?.invalid && detailCode?.touched" [disabled]="!mainsSaved" />
                            @if (detailCode?.invalid && detailCode?.touched) {
                            <span class="error-text">Code is required (min 2 chars)</span>
                            }
                        </div>

                        <div class="form-group">
                            <label for="sortOrder">Sort Order <span class="required">*</span></label>
                            <input id="sortOrder" type="number" formControlName="sortOrder" readonly
                                class="readonly-input" [disabled]="!mainsSaved" />
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="detailNameAr">Name (Arabic) <span class="required">*</span></label>
                            <input id="detailNameAr" type="text" formControlName="nameAr" placeholder="Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"
                                dir="rtl" [class.invalid]="detailNameAr?.invalid && detailNameAr?.touched"
                                [disabled]="!mainsSaved" />
                            @if (detailNameAr?.invalid && detailNameAr?.touched) {
                            <span class="error-text">Arabic name is required</span>
                            }
                        </div>

                        <div class="form-group">
                            <label for="detailNameEn">Name (English) <span class="required">*</span></label>
                            <input id="detailNameEn" type="text" formControlName="nameEn" placeholder="English Name"
                                [class.invalid]="detailNameEn?.invalid && detailNameEn?.touched"
                                [disabled]="!mainsSaved" />
                            @if (detailNameEn?.invalid && detailNameEn?.touched) {
                            <span class="error-text">English name is required</span>
                            }
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="detailDescriptionAr">Description (Arabic) <span
                                    class="required">*</span></label>
                            <textarea id="detailDescriptionAr" formControlName="descriptionAr"
                                placeholder="Ø§Ù„ÙˆØµÙ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©" dir="rtl" rows="4"
                                [class.invalid]="detailDescriptionAr?.invalid && detailDescriptionAr?.touched"
                                [disabled]="!mainsSaved"></textarea>
                            @if (detailDescriptionAr?.invalid && detailDescriptionAr?.touched) {
                            <span class="error-text">Arabic description is required</span>
                            }
                        </div>

                        <div class="form-group">
                            <label for="detailDescriptionEn">Description (English) <span
                                    class="required">*</span></label>
                            <textarea id="detailDescriptionEn" formControlName="descriptionEn"
                                placeholder="English Description" rows="4"
                                [class.invalid]="detailDescriptionEn?.invalid && detailDescriptionEn?.touched"
                                [disabled]="!mainsSaved"></textarea>
                            @if (detailDescriptionEn?.invalid && detailDescriptionEn?.touched) {
                            <span class="error-text">English description is required</span>
                            }
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary" [disabled]="!mainsSaved || isLoading">
                            Add Detail
                        </button>
                    </div>
                </form>
            </div>

            @if (details.length > 0) {
            <div class="card details-list">
                <h3>Added Detail Entries ({{ details.length }})</h3>
                <p>Review your detail entries before saving</p>

                <div class="details-table">
                    @for (detail of details; track $index) {
                    <div class="detail-item">
                        <div class="detail-header">
                            <h4>Detail Entry #{{ $index + 1 }}</h4>
                            <button type="button" class="btn btn-delete" (click)="removeDetail($index)"
                                [disabled]="isLoading">
                                âœ• Remove
                            </button>
                        </div>
                        <div class="detail-details">
                            <div class="detail-row">
                                <div class="detail-field">
                                    <strong>Code:</strong>
                                    <span>{{ detail.code }}</span>
                                </div>
                                <div class="detail-field">
                                    <strong>Sort Order:</strong>
                                    <span>{{ detail.sortOrder }}</span>
                                </div>
                            </div>
                            <div class="detail-row">
                                <div class="detail-field">
                                    <strong>Name (Arabic):</strong>
                                    <span dir="rtl">{{ detail.nameAr }}</span>
                                </div>
                                <div class="detail-field">
                                    <strong>Name (English):</strong>
                                    <span>{{ detail.nameEn }}</span>
                                </div>
                            </div>
                            <div class="detail-row">
                                <div class="detail-field">
                                    <strong>Description (Arabic):</strong>
                                    <span dir="rtl">{{ detail.descriptionAr }}</span>
                                </div>
                                <div class="detail-field">
                                    <strong>Description (English):</strong>
                                    <span>{{ detail.descriptionEn }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    }
                </div>

                <div class="save-all-actions">
                    <button type="button" class="btn btn-success" (click)="saveAllDetails()" [disabled]="isLoading">
                        @if (isLoading) {
                        <span class="spinner"></span>
                        Saving All Details...
                        } @else {
                        Save All Details & Complete
                        }
                    </button>
                </div>
            </div>
            }
        </div>
    </section>
</div>