<div class="code-type-main-container">
    <div class="header">
        <h2>Code Type Main</h2>
        <p class="description">Configure main settings - {{ mains.length }} of {{ codeAttributeTypeIds.length }} entries added</p>
    </div>

    <div class="content">
        <div class="card">
            <h3>Add New Main Entry</h3>
            <p>Enter main details and click "Add Main" to add it to the list ({{ mains.length }}/{{ codeAttributeTypeIds.length }})</p>

            <app-alert *ngIf="successMessage" type="success" [message]="successMessage"></app-alert>
            <app-alert *ngIf="errorMessage" type="error" [message]="errorMessage"></app-alert>

            <form [formGroup]="mainForm" (ngSubmit)="onSubmit()" class="form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="code">Code <span class="required">*</span></label>
                        <input id="code" type="text" formControlName="code" placeholder="e.g., SYS, DEPT"
                            [class.invalid]="code?.invalid && code?.touched" />
                        @if (code?.invalid && code?.touched) {
                        <span class="error-text">
                            @if (code?.errors?.['required']) {
                            Code is required
                            } @else if (code?.errors?.['minlength']) {
                            Code must be at least 2 characters
                            }
                        </span>
                        }
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="nameAr">Name (Arabic) <span class="required">*</span></label>
                        <input id="nameAr" type="text" formControlName="nameAr" placeholder="الاسم بالعربية" dir="rtl"
                            [class.invalid]="nameAr?.invalid && nameAr?.touched" />
                        @if (nameAr?.invalid && nameAr?.touched) {
                        <span class="error-text">Arabic name is required</span>
                        }
                    </div>

                    <div class="form-group">
                        <label for="nameEn">Name (English) <span class="required">*</span></label>
                        <input id="nameEn" type="text" formControlName="nameEn" placeholder="English Name"
                            [class.invalid]="nameEn?.invalid && nameEn?.touched" />
                        @if (nameEn?.invalid && nameEn?.touched) {
                        <span class="error-text">English name is required</span>
                        }
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="descriptionAr">Description (Arabic) <span class="required">*</span></label>
                        <textarea id="descriptionAr" formControlName="descriptionAr" placeholder="الوصف بالعربية"
                            dir="rtl" rows="4"
                            [class.invalid]="descriptionAr?.invalid && descriptionAr?.touched"></textarea>
                        @if (descriptionAr?.invalid && descriptionAr?.touched) {
                        <span class="error-text">Arabic description is required</span>
                        }
                    </div>

                    <div class="form-group">
                        <label for="descriptionEn">Description (English) <span class="required">*</span></label>
                        <textarea id="descriptionEn" formControlName="descriptionEn" placeholder="English Description"
                            rows="4" [class.invalid]="descriptionEn?.invalid && descriptionEn?.touched"></textarea>
                        @if (descriptionEn?.invalid && descriptionEn?.touched) {
                        <span class="error-text">English description is required</span>
                        }
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary" [disabled]="isLoading || mains.length >= codeAttributeTypeIds.length">
                        Add Main
                    </button>
                </div>
            </form>
        </div>

        @if (mains.length > 0) {
        <div class="card mains-list">
            <h3>Added Main Entries ({{ mains.length }}/{{ codeAttributeTypeIds.length }})</h3>
            <p>Review your main entries before saving</p>
            
            <div class="mains-table">
                @for (main of mains; track $index) {
                <div class="main-item">
                    <div class="main-header">
                        <h4>Main Entry #{{ $index + 1 }}</h4>
                        <button type="button" class="btn btn-delete" (click)="removeMain($index)" [disabled]="isLoading">
                            ✕ Remove
                        </button>
                    </div>
                    <div class="main-details">
                        <div class="detail-row">
                            <div class="detail-item">
                                <strong>Code:</strong>
                                <span>{{ main.code }}</span>
                            </div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-item">
                                <strong>Name (Arabic):</strong>
                                <span dir="rtl">{{ main.nameAr }}</span>
                            </div>
                            <div class="detail-item">
                                <strong>Name (English):</strong>
                                <span>{{ main.nameEn }}</span>
                            </div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-item">
                                <strong>Description (Arabic):</strong>
                                <span dir="rtl">{{ main.descriptionAr }}</span>
                            </div>
                            <div class="detail-item">
                                <strong>Description (English):</strong>
                                <span>{{ main.descriptionEn }}</span>
                            </div>
                        </div>
                    </div>
                </div>
                }
            </div>

            <div class="save-all-actions">
                <button type="button" class="btn btn-success" (click)="saveAllMains()" [disabled]="isLoading || mains.length !== codeAttributeTypeIds.length">
                    @if (isLoading) {
                    <span class="spinner"></span>
                    Saving All Mains...
                    } @else {
                    Save All Mains & Continue
                    }
                </button>
            </div>
        </div>
        }
    </div>
</div>